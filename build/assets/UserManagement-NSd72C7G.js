import{j as e}from"./markdown-Bat84yML.js";import{r as n,z as S,U as Q,y as K,i as Y,m as G,h as j,j as H,aJ as V,a3 as W,J as X}from"./lucide-Bfyd0ICn.js";import{M as C}from"./Modal-CuQkZSTM.js";import"./react-vendor-N--QU9DW.js";const ae=({currentUser:D,authToken:A})=>{const[b,U]=n.useState([]),[M,E]=n.useState(!0),[g,c]=n.useState(""),[v,h]=n.useState(""),[P,N]=n.useState(!1),[I,f]=n.useState(!1),[L,w]=n.useState(!1),[R,y]=n.useState(!1),[o,x]=n.useState(null),[t,a]=n.useState({email:"",password:"",name:"",role:"user",server_limit:0,cpu_limit:100,memory_limit:1024,disk_limit:10240,backup_limit:3,port_limit:5}),[z,k]=n.useState(""),[d,m]=n.useState(!1),p={"Content-Type":"application/json",Authorization:`Bearer ${A}`};n.useEffect(()=>{_()},[]);const _=async()=>{try{E(!0);const s=await fetch("/api/admin/users",{headers:p});if(!s.ok)throw new Error("Failed to load users");const r=await s.json();U(r.users||[])}catch(s){c(s.message)}finally{E(!1)}},T=async s=>{s.preventDefault(),m(!0),c("");try{const r=await fetch("/api/admin/users",{method:"POST",headers:p,body:JSON.stringify(t)}),u=await r.json();if(!r.ok)throw new Error(u.error||"Failed to create user");h("User created successfully"),N(!1),a({email:"",password:"",name:"",role:"user",server_limit:0,cpu_limit:100,memory_limit:1024,disk_limit:10240,backup_limit:3,port_limit:5}),_()}catch(r){c(r.message)}finally{m(!1)}},O=async s=>{if(s.preventDefault(),!!o){m(!0),c("");try{const r=await fetch(`/api/admin/users/${o.id}`,{method:"PUT",headers:p,body:JSON.stringify({email:t.email,name:t.name,role:t.role,is_active:t.is_active,server_limit:t.server_limit,cpu_limit:t.cpu_limit,memory_limit:t.memory_limit,disk_limit:t.disk_limit,backup_limit:t.backup_limit,port_limit:t.port_limit})}),u=await r.json();if(!r.ok)throw new Error(u.error||"Failed to update user");h("User updated successfully"),f(!1),x(null),_()}catch(r){c(r.message)}finally{m(!1)}}},B=async s=>{if(s.preventDefault(),!!o){m(!0),c("");try{const r=await fetch(`/api/admin/users/${o.id}/password`,{method:"PUT",headers:p,body:JSON.stringify({password:z})}),u=await r.json();if(!r.ok)throw new Error(u.error||"Failed to reset password");h("Password reset successfully"),w(!1),k(""),x(null)}catch(r){c(r.message)}finally{m(!1)}}},F=async()=>{if(o){m(!0),c("");try{const s=await fetch(`/api/admin/users/${o.id}`,{method:"DELETE",headers:p}),r=await s.json();if(!s.ok)throw new Error(r.error||"Failed to delete user");h("User deleted successfully"),y(!1),x(null),_()}catch(s){c(s.message)}finally{m(!1)}}},J=s=>{x(s),a({email:s.email,name:s.name||"",role:s.role,is_active:s.is_active,server_limit:s.server_limit??0,cpu_limit:s.cpu_limit??100,memory_limit:s.memory_limit??1024,disk_limit:s.disk_limit??10240,backup_limit:s.backup_limit??3,port_limit:s.port_limit??5}),f(!0)},$=s=>{x(s),k(""),w(!0)},q=s=>{x(s),y(!0)};if(n.useEffect(()=>{if(v){const s=setTimeout(()=>h(""),3e3);return()=>clearTimeout(s)}},[v]),n.useEffect(()=>{if(g){const s=setTimeout(()=>c(""),5e3);return()=>clearTimeout(s)}},[g]),D?.role!=="admin")return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-12 h-12 text-zinc-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-medium text-white mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-zinc-500",children:"You don't have permission to access this page."})]})});const i="w-full px-3 py-2.5 bg-white/[0.03] border border-white/[0.06] rounded-lg text-white placeholder:text-zinc-600 outline-none focus:border-[#7C3AED]/50 transition-colors text-sm",l="block text-xs font-medium text-zinc-400 uppercase tracking-wider mb-2";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#7C3AED]/10 border border-[#7C3AED]/20 flex items-center justify-center",children:e.jsx(Q,{className:"w-5 h-5 text-[#7C3AED]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-medium text-white",children:"User Management"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[b.length," user",b.length!==1?"s":""]})]})]}),e.jsxs("button",{onClick:()=>{a({email:"",password:"",name:"",role:"user",server_limit:0,cpu_limit:100,memory_limit:1024,disk_limit:10240,backup_limit:3,port_limit:5}),N(!0)},className:"flex items-center gap-2 px-4 py-2 bg-[#7C3AED] hover:bg-[#6D28D9] text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Create User"})]})]}),g&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx(Y,{className:"w-4 h-4 text-red-400"}),e.jsx("p",{className:"text-sm text-red-300",children:g})]}),v&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-green-500/10 border border-green-500/20",children:[e.jsx(G,{className:"w-4 h-4 text-green-400"}),e.jsx("p",{className:"text-sm text-green-300",children:v})]}),M?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(j,{className:"w-6 h-6 text-zinc-500 animate-spin"})}):b.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(H,{className:"w-12 h-12 text-zinc-600 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-500",children:"No users found"})]}):e.jsx("div",{className:"bg-white/[0.02] border border-white/[0.04] rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/[0.04]",children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Last Login"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{className:"border-b border-white/[0.02] last:border-0 hover:bg-white/[0.01] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/[0.05] flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:(s.name||s.email||"?")[0].toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:s.name||"Unnamed"}),e.jsx("p",{className:"text-xs text-zinc-500",children:s.email})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded text-xs font-medium ${s.role==="admin"?"bg-[#7C3AED]/10 text-[#7C3AED] border border-[#7C3AED]/20":"bg-zinc-500/10 text-zinc-400 border border-zinc-500/20"}`,children:[s.role==="admin"&&e.jsx(S,{className:"w-3 h-3"}),s.role]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${s.is_active?"bg-green-500":"bg-zinc-600"}`}),e.jsx("span",{className:"text-sm text-zinc-400",children:s.is_active?"Active":"Inactive"})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-zinc-500",children:s.last_login?new Date(s.last_login).toLocaleDateString():"Never"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>J(s),className:"p-2 text-zinc-500 hover:text-white hover:bg-white/[0.05] rounded-lg transition-colors",title:"Edit",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$(s),className:"p-2 text-zinc-500 hover:text-[#7C3AED] hover:bg-[#7C3AED]/10 rounded-lg transition-colors",title:"Reset Password",children:e.jsx(W,{className:"w-4 h-4"})}),s.id!==D?.id&&e.jsx("button",{onClick:()=>q(s),className:"p-2 text-zinc-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(X,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx(C,{isOpen:P,onClose:()=>N(!1),title:"Create User",children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Name"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>a({...t,name:s.target.value}),placeholder:"John Doe",className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>a({...t,email:s.target.value}),placeholder:"user@example.com",required:!0,className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Password"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>a({...t,password:s.target.value}),placeholder:"Min. 8 characters",required:!0,minLength:8,className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Role"}),e.jsxs("select",{value:t.role,onChange:s=>a({...t,role:s.target.value}),className:i,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-white/[0.06] mt-4",children:[e.jsx("h4",{className:"text-[10px] font-mono tracking-[0.3em] text-[#7C3AED] uppercase mb-4",children:"Resource Quotas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Server Limit"}),e.jsx("input",{type:"number",value:t.server_limit,onChange:s=>a({...t,server_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"CPU Limit (%)"}),e.jsx("input",{type:"number",value:t.cpu_limit,onChange:s=>a({...t,cpu_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Memory (MB)"}),e.jsx("input",{type:"number",value:t.memory_limit,onChange:s=>a({...t,memory_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Disk (MB)"}),e.jsx("input",{type:"number",value:t.disk_limit,onChange:s=>a({...t,disk_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Backups"}),e.jsx("input",{type:"number",value:t.backup_limit,onChange:s=>a({...t,backup_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Ports"}),e.jsx("input",{type:"number",value:t.port_limit,onChange:s=>a({...t,port_limit:parseInt(s.target.value)||0}),className:i})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-4 py-2 text-zinc-400 hover:text-white transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-[#7C3AED] hover:bg-[#6D28D9] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2",children:[d&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),"Create User"]})]})]})}),e.jsx(C,{isOpen:I,onClose:()=>f(!1),title:"Edit User",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Name"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>a({...t,name:s.target.value}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>a({...t,email:s.target.value}),required:!0,className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Role"}),e.jsxs("select",{value:t.role,onChange:s=>a({...t,role:s.target.value}),className:i,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-white/[0.06] mt-4",children:[e.jsx("h4",{className:"text-[10px] font-mono tracking-[0.3em] text-[#7C3AED] uppercase mb-4",children:"Resource Quotas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Server Limit"}),e.jsx("input",{type:"number",value:t.server_limit,onChange:s=>a({...t,server_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"CPU Limit (%)"}),e.jsx("input",{type:"number",value:t.cpu_limit,onChange:s=>a({...t,cpu_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Memory (MB)"}),e.jsx("input",{type:"number",value:t.memory_limit,onChange:s=>a({...t,memory_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Disk (MB)"}),e.jsx("input",{type:"number",value:t.disk_limit,onChange:s=>a({...t,disk_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Backups"}),e.jsx("input",{type:"number",value:t.backup_limit,onChange:s=>a({...t,backup_limit:parseInt(s.target.value)||0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"Ports"}),e.jsx("input",{type:"number",value:t.port_limit,onChange:s=>a({...t,port_limit:parseInt(s.target.value)||0}),className:i})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:t.is_active,onChange:s=>a({...t,is_active:s.target.checked}),className:"w-4 h-4 rounded border-zinc-600 bg-transparent text-[#7C3AED] focus:ring-[#7C3AED]"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-zinc-400",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 text-zinc-400 hover:text-white transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-[#7C3AED] hover:bg-[#6D28D9] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2",children:[d&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),"Save Changes"]})]})]})}),e.jsx(C,{isOpen:L,onClose:()=>w(!1),title:"Reset Password",children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-zinc-400",children:["Set a new password for ",e.jsx("span",{className:"text-white font-medium",children:o?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:l,children:"New Password"}),e.jsx("input",{type:"password",value:z,onChange:s=>k(s.target.value),placeholder:"Min. 8 characters",required:!0,minLength:8,className:i})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 text-zinc-400 hover:text-white transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-[#7C3AED] hover:bg-[#6D28D9] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2",children:[d&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),"Reset Password"]})]})]})}),e.jsx(C,{isOpen:R,onClose:()=>y(!1),title:"Delete User",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-zinc-400",children:["Are you sure you want to delete ",e.jsx("span",{className:"text-white font-medium",children:o?.email}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 text-zinc-400 hover:text-white transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:F,disabled:d,className:"px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2",children:[d&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),"Delete User"]})]})]})})]})};export{ae as default};
