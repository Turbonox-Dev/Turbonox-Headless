import{j as e}from"./markdown-Bat84yML.js";import{c as Y,F as We,G as ze,z as ee,S as Ue,E as je,T as he,w as Ge,J as Je,K as be,r,Z as it,X as nt,O as qe,Q as lt,C as dt,V as Ne,i as ct,o as mt,W as xt,Y as De,t as Ie,e as ut,I as pt,A as bt,q as vt,p as ht,D as gt,u as ft,y as Me,_ as Te,$ as jt,m as Nt}from"./lucide-Bfyd0ICn.js";import{u as ge}from"./index-BOUrY8QV.js";import{V as ve}from"./VoidDropdown-C1MOWfVa.js";import{x as yt,a as wt}from"./xterm-B1V9QH9F.js";import{R as St}from"./RestrictedView-Cn5sOcE9.js";import"./react-vendor-N--QU9DW.js";const kt=({server:t,dockerReady:m=!0,onStart:c,onStop:f,onRestart:i,onDelete:y,onViewLogs:d,onOpen:l,onEdit:x=()=>{}})=>{const v=t.status==="running",u=String(t?.execution_mode||"native").toLowerCase()==="docker",h=u&&!m,C=!!t.public_access,A=!!t.isolation_enabled,S=t.cpu_limit_percent?`${Number(t.cpu_limit_percent)}%`:"Unlimited",I=t.memory_limit_mb?`${Number(t.memory_limit_mb)} MB`:"Unlimited",p=t.disk_limit_mb?`${Number(t.disk_limit_mb)} MB`:"Unlimited",R={nodejs:{icon:Y},python:{icon:Y},php:{icon:Y},static:{icon:We},custom:{icon:Y}};let _=null;try{_=(t?.metadata?JSON.parse(t.metadata):null)?.egg||null}catch{_=null}const s=String(t.type||"server"),o=s.startsWith("template:")?s.replace(/^template:/,""):s,j=_?.name?String(_.name):o==="nodejs"?"Node.js":o==="python"?"Python":o==="php"?"PHP":o==="static"?"Static":o==="custom"?"Custom":String(s),T=t.bridged_port||t.port,L=T?`localhost:${Number(T)}`:null,P=L?`http://${L}`:null,te=R[t.type]?.icon||Y;String(t?.runtime_preset||"").trim();const F=w=>J=>{J.stopPropagation(),w()},G=async(w,J)=>{try{J&&(J.preventDefault(),J.stopPropagation());const z=window?.electronAPI;if(z?.openExternal){await z.openExternal(String(w));return}}catch{}try{window.open(String(w),"_blank","noopener,noreferrer")}catch{}};return e.jsxs("div",{className:"bg-black border border-void-border p-5 hover:border-void-border/80 transition-all cursor-pointer group",onClick:l,role:"button",tabIndex:0,onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),l?.())},children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 border border-void-border bg-void-bg",children:e.jsx(te,{className:"w-5 h-5 text-void-text"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-void-text font-mono uppercase tracking-wider",children:t.name}),e.jsxs("p",{className:"text-[10px] text-void-muted font-mono uppercase tracking-wide mt-0.5",children:[j,t.port?e.jsxs(e.Fragment,{children:[" • ",":",t.port,t.bridged_port&&e.jsxs("span",{className:"ml-1.5 text-void-text",children:["Possible Port Conflict ",t.bridged_port]})]}):""]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:`text-[10px] uppercase tracking-wider font-mono px-1.5 py-0.5 border ${v?"border-purple-500/50 text-purple-400 bg-purple-500/10":"border-void-border text-void-muted"}`,children:v?"Online":"Offline"})})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[C&&e.jsxs("div",{className:"text-[9px] uppercase tracking-wider font-mono px-1.5 py-0.5 border border-purple-500/30 text-purple-400 flex items-center gap-1",children:[e.jsx(ze,{className:"w-2.5 h-2.5"})," Public"]}),A&&e.jsxs("div",{className:"text-[9px] uppercase tracking-wider font-mono px-1.5 py-0.5 border border-void-border text-void-muted flex items-center gap-1",children:[e.jsx(ee,{className:"w-2.5 h-2.5"})," Iso"]}),u&&e.jsx("div",{className:"text-[9px] uppercase tracking-wider font-mono px-1.5 py-0.5 border border-void-border text-void-muted",children:"Docker"})]}),P&&e.jsx("a",{href:P,className:"block text-xs text-void-muted hover:text-white font-mono hover:underline truncate transition-colors",title:L||P,onClick:w=>G(P,w),children:L}),e.jsx("div",{className:"text-[10px] text-void-muted truncate font-mono opacity-60",title:t.path,children:t.path}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"border border-void-border p-2",children:[e.jsx("div",{className:"flex items-center gap-1 text-[9px] text-void-muted uppercase tracking-wider font-mono mb-0.5",children:"CPU"}),e.jsx("div",{className:"text-xs text-void-text font-mono font-bold",children:S})]}),e.jsxs("div",{className:"border border-void-border p-2",children:[e.jsx("div",{className:"flex items-center gap-1 text-[9px] text-void-muted uppercase tracking-wider font-mono mb-0.5",children:"RAM"}),e.jsx("div",{className:"text-xs text-void-text font-mono font-bold",children:I})]}),e.jsxs("div",{className:"border border-void-border p-2",children:[e.jsx("div",{className:"flex items-center gap-1 text-[9px] text-void-muted uppercase tracking-wider font-mono mb-0.5",children:"Disk"}),e.jsx("div",{className:"text-xs text-void-text font-mono font-bold",children:p})]})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[v?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F(f),disabled:h,title:h?"Docker engine is not ready":"Stop server",className:"px-3 py-1.5 border border-void-border hover:border-red-500/50 hover:text-red-400 text-void-muted transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:e.jsx(Ue,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:F(i),disabled:h,title:h?"Docker engine is not ready":"Restart server",className:"px-3 py-1.5 border border-void-border hover:border-void-border/80 text-void-muted hover:text-white transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:e.jsx(je,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:F(d),className:"px-3 py-1.5 border border-void-border hover:border-void-border/80 text-void-muted hover:text-white transition-all",title:"Console",children:e.jsx(he,{className:"w-3.5 h-3.5"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:F(c),disabled:h,title:h?"Docker engine is not ready":"Start server",className:"flex-1 px-3 py-1.5 border border-void-border hover:bg-white/5 text-void-text transition-all text-xs font-mono uppercase tracking-wide flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"})," Start"]}),e.jsx("button",{onClick:F(y),className:"px-3 py-1.5 border border-void-border hover:border-red-500/50 hover:text-red-400 text-void-muted transition-all",title:"Delete",children:e.jsx(Je,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:F(x),className:"px-3 py-1.5 border border-void-border hover:border-void-border/80 text-void-muted hover:text-white transition-all",title:"Settings",children:e.jsx(be,{className:"w-3.5 h-3.5"})})]})]})},Ct=({onClose:t,onCreate:m,nodes:c=[],cloudUser:f,serverCount:i=0})=>{const y=ge(),[d,l]=r.useState({name:"",type:"template:nodejs",command:"",port:"",publicAccess:!1,executionMode:"docker",runtimePreset:"",installCommand:"",startCommand:""}),[x,v]=r.useState([]),[u,h]=r.useState(!0),[C,A]=r.useState(""),[S,I]=r.useState("nodejs"),p=r.useMemo(()=>(x||[]).find(s=>String(s.id)===String(S))||null,[x,S]),R=async()=>{try{const s=window.electronAPI;if(!s?.getTemplates)throw new Error("CORE_API_UNAVAILABLE: ELECTRON_BRIDGE_DISCONNECTED");const o=await s.getTemplates();v(Array.isArray(o?.templates)?o.templates:[])}catch(s){A(s.message)}finally{h(!1)}};r.useEffect(()=>{R()},[]),r.useEffect(()=>{p&&l(s=>({...s,type:`template:${p.id}`,runtimePreset:p.runtime_preset||"ubuntu-22.04",installCommand:p.install_command||"",startCommand:p.start_command||"",command:p.start_command||s.command,port:String(p.default_port||s.port||"")}))},[p]);const _=s=>{if(s.preventDefault(),!d.name){y.alert("ALLOCATION_FAILED: INSTANCE_NAME_REQUIRED");return}m({...d,autoPort:!d.port})};return u?null:e.jsx("div",{className:"fixed inset-0 bg-[#000000]/95 flex items-center justify-center z-50 p-6 backdrop-blur-md",children:e.jsxs("div",{className:"bg-[#000000] border border-[#1A1A1A] w-full max-w-4xl h-[70vh] flex flex-col overflow-hidden shadow-[0_0_100px_rgba(0,0,0,1)]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-[#1A1A1A]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 border border-[#7C3AED] flex items-center justify-center bg-[#7C3AED]/5",children:e.jsx(it,{className:"w-5 h-5 text-[#7C3AED] fill-[#7C3AED]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white tracking-tighter uppercase",children:"Instance Allocator"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-[10px] font-mono tracking-[0.3em] text-[#555555] uppercase",children:"Module: Rapid_Provisioning"}),e.jsx("div",{className:"w-1 h-1 bg-[#222222] rounded-full"}),e.jsx("span",{className:"text-[10px] font-mono tracking-[0.3em] text-[#7C3AED] uppercase",children:"v3.0.0_Lite"})]})]})]}),e.jsx("button",{onClick:t,className:"p-2 border border-[#1A1A1A] text-[#555555] hover:text-white hover:border-white transition-all duration-150",children:e.jsx(nt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto grid grid-cols-12 gap-0",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 p-10 border-r border-[#1A1A1A] space-y-12",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] font-mono text-[#7C3AED] font-bold tracking-[0.4em] uppercase",children:"01/Identity"}),e.jsx("div",{className:"h-[1px] flex-1 bg-[#1A1A1A]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[9px] font-mono tracking-[0.3em] text-[#555555] uppercase mb-2",children:"Instance_Label"}),e.jsx("input",{type:"text",value:d.name,onChange:s=>l({...d,name:s.target.value}),placeholder:"SRV_ALPHA_01",className:"w-full bg-[#000000] border border-[#1A1A1A] p-5 text-sm font-mono text-white focus:outline-none focus:border-[#7C3AED] transition-all"})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] font-mono text-[#7C3AED] font-bold tracking-[0.4em] uppercase",children:"02/Environment"}),e.jsx("div",{className:"h-[1px] flex-1 bg-[#1A1A1A]"})]}),C?e.jsxs("div",{className:"p-4 border border-red-900/50 bg-red-900/5 flex items-center gap-3",children:[e.jsx(qe,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-[10px] font-mono text-red-500 uppercase tracking-widest",children:C})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:x.map(s=>{const o=String(s.id)===String(S);return e.jsxs("button",{type:"button",onClick:()=>I(s.id),className:`p-5 border transition-all text-left group ${o?"border-[#7C3AED] bg-[#7C3AED]/5":"border-[#1A1A1A] hover:border-[#333333]"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:`p-2 border ${o?"border-[#7C3AED] text-[#7C3AED]":"border-[#1A1A1A] text-[#333333]"}`,children:e.jsx(lt,{className:"w-4 h-4"})}),o&&e.jsx("div",{className:"w-2 h-2 bg-[#7C3AED]"})]}),e.jsx("div",{className:"text-[12px] font-bold text-white uppercase tracking-tight",children:s.name}),e.jsx("div",{className:"text-[8px] font-mono text-[#555555] uppercase mt-2 tracking-widest",children:s.runtime_preset||"latest"})]},s.id)})})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-4 p-10 bg-[#050505]/50 flex flex-col",children:[e.jsxs("section",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] font-mono text-[#7C3AED] font-bold tracking-[0.4em] uppercase",children:"Summary"}),e.jsx("div",{className:"h-[1px] flex-1 bg-[#1A1A1A]"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 border border-[#1A1A1A] bg-black/40 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-[8px] font-mono uppercase tracking-widest text-[#555555]",children:[e.jsx("span",{children:"Resource_Policy"}),e.jsx("span",{className:"text-white",children:"AUTO_QUOTA"})]}),e.jsxs("div",{className:"flex justify-between text-[8px] font-mono uppercase tracking-widest text-[#555555]",children:[e.jsx("span",{children:"Filesystem"}),e.jsx("span",{className:"text-white",children:"AUTO_MANAGED"})]}),e.jsxs("div",{className:"flex justify-between text-[8px] font-mono uppercase tracking-widest text-[#555555]",children:[e.jsx("span",{children:"Node_Placement"}),e.jsx("span",{className:"text-white",children:"LOCAL_POOL"})]})]}),e.jsxs("div",{className:"p-4 border border-[#1A1A1A] bg-black/40",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ze,{className:"w-3 h-3 text-[#555555]"}),e.jsx("span",{className:"text-[9px] font-mono text-white tracking-widest uppercase",children:"Public_Gateway"})]}),e.jsx("button",{type:"button",onClick:()=>l({...d,publicAccess:!d.publicAccess}),className:`w-full h-8 border transition-all flex items-center justify-center gap-2 ${d.publicAccess?"border-[#7C3AED] bg-[#7C3AED]/10 text-[#7C3AED]":"border-[#1A1A1A] text-[#555555]"}`,children:e.jsx("span",{className:"text-[9px] font-mono tracking-[0.2em]",children:d.publicAccess?"ENABLED":"DISABLED"})})]})]})]}),e.jsxs("div",{className:"mt-8 p-4 border border-[#7C3AED]/20 bg-[#7C3AED]/5 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-3 h-3 text-[#7C3AED]"}),e.jsx("span",{className:"text-[8px] font-mono text-[#7C3AED] uppercase tracking-widest",children:"Security_Kernel_Active"})]}),e.jsx("p",{className:"text-[8px] font-mono text-[#555555] uppercase leading-relaxed",children:"Instance will be isolated in a secure container with strict resource limits enforced by the administrator."})]}),e.jsx("div",{className:"mt-auto pt-10",children:e.jsxs("button",{onClick:_,className:"w-full py-6 bg-white hover:bg-[#7C3AED] text-black hover:text-white font-bold text-sm tracking-[0.5em] uppercase transition-all flex items-center justify-center gap-4 group",children:["Create ",e.jsx(dt,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})})]})]})]})})},Ve=({server:t,onClose:m,onSaved:c})=>{const f=ge(),[i,y]=r.useState({}),[d,l]=r.useState(!1),[x,v]=r.useState(""),[u,h]=r.useState([]),[C,A]=r.useState(!1),[S,I]=r.useState("");r.useEffect(()=>{if(t){y({name:t.name||"",type:t.type||"",serverPath:t.path||"",command:t.command||"",startCommand:t.start_command||"",installCommand:t.install_command||"",port:t.port??"",publicAccess:!!t.public_access,isolationEnabled:!!t.isolation_enabled,cpuLimitPercent:t.cpu_limit_percent??"",memoryLimitMb:t.memory_limit_mb??"",diskLimitMb:t.disk_limit_mb??"",staticIp:t.static_ip||"",networkName:t.network_name||"bridge",autoPort:!!t.auto_port});try{const s=t?.env_vars?JSON.parse(t.env_vars):{};I(JSON.stringify(s,null,2))}catch{I("")}}},[t]),r.useEffect(()=>{let s=!0;return(async()=>{A(!0);try{const j=window.electronAPI;if(j?.getTemplates){const L=(await j.getTemplates().catch(()=>null))?.templates||[];if(!s)return;h(L)}}catch{}finally{s&&A(!1)}})(),()=>{s=!1}},[]);const p=(s,o)=>y(j=>({...j,[s]:o})),R=async()=>{try{const s=await window.electronAPI.selectDirectory();s&&p("serverPath",s)}catch{const s=await f.prompt("Enter server path:","Manual Selection");s&&p("serverPath",s)}},_=async s=>{s.preventDefault(),l(!0),v("");try{let o=null;try{o=S?JSON.parse(S):null}catch{throw new Error("Environment variables JSON is invalid")}const j={name:i.name,type:i.type,serverPath:i.serverPath,command:i.command,startCommand:i.startCommand,installCommand:i.installCommand,port:i.autoPort||i.port===""?null:i.port,publicAccess:!!i.publicAccess,isolationEnabled:!!i.isolationEnabled,cpuLimitPercent:i.cpuLimitPercent===""?null:Number(i.cpuLimitPercent),memoryLimitMb:i.memoryLimitMb===""?null:Number(i.memoryLimitMb),diskLimitMb:i.diskLimitMb===""?null:Number(i.diskLimitMb),staticIp:i.staticIp||null,networkName:i.networkName||"bridge",autoPort:!!i.autoPort,envVars:o};await window.electronAPI.updateServer(t.id,j),typeof c=="function"&&c(t.id)}catch(o){v(o?.message||String(o))}finally{l(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-void-panel-2 bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-void-border flex items-center justify-between sticky top-0 bg-void-panel z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-void-text",children:"Edit Server"}),e.jsx("div",{className:"text-sm text-void-muted",children:"Modify server settings, commands, ports and limits"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"px-3 py-2 bg-void-border hover:bg-void-purple text-void-text rounded",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:d,className:"px-4 py-2 bg-void-cyan/15 hover:bg-void-cyan/20 text-void-text rounded font-semibold",children:d?"Saving...":"Save changes"})]})]}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-6",children:[x?e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-200 rounded",children:x}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Name"}),e.jsx("input",{value:i.name,onChange:s=>p("name",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Type / Template"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(ve,{value:i.type,options:[{value:i.type||"",label:i.type||"Custom"},...u.map(s=>({value:`template:${s.id}`,label:s.name||s.id}))],onChange:s=>p("type",s),disabled:C,className:"flex-1"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:i.serverPath,onChange:s=>p("serverPath",s.target.value),className:"flex-1 px-3 py-2 bg-void-bg border border-void-border rounded"}),e.jsx("button",{type:"button",onClick:R,className:"px-3 py-2 bg-void-panel-2 hover:bg-white/10 border border-void-border rounded",children:"Browse"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Start Command"}),e.jsx("input",{value:i.startCommand,onChange:s=>p("startCommand",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Install Command"}),e.jsx("input",{value:i.installCommand,onChange:s=>p("installCommand",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Static IP (Optional)"}),e.jsx("input",{value:i.staticIp,onChange:s=>p("staticIp",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded",placeholder:"e.g. 172.18.0.2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Docker Network"}),e.jsx("input",{value:i.networkName,onChange:s=>p("networkName",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded",placeholder:"bridge"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Port"}),e.jsx("input",{value:i.port??"",onChange:s=>p("port",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded",placeholder:"e.g. 3000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Auto Port"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:!!i.autoPort,onChange:s=>p("autoPort",s.target.checked)}),e.jsx("span",{className:"text-sm text-void-muted",children:"Allocate automatically if empty"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"CPU Limit (%)"}),e.jsx("input",{value:i.cpuLimitPercent??"",onChange:s=>p("cpuLimitPercent",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Memory MB"}),e.jsx("input",{value:i.memoryLimitMb??"",onChange:s=>p("memoryLimitMb",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Disk MB"}),e.jsx("input",{value:i.diskLimitMb??"",onChange:s=>p("diskLimitMb",s.target.value),className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!i.publicAccess,onChange:s=>p("publicAccess",s.target.checked)}),e.jsx("span",{className:"text-sm text-void-muted",children:"Public access (open firewall)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!i.isolationEnabled,onChange:s=>p("isolationEnabled",s.target.checked)}),e.jsx("span",{className:"text-sm text-void-muted",children:"Enable isolation (job object)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-void-muted mb-1",children:"Environment Variables (JSON)"}),e.jsx("textarea",{value:S,onChange:s=>I(s.target.value),rows:6,className:"w-full px-3 py-2 bg-void-bg border border-void-border rounded font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:m,disabled:d,className:"px-4 py-2 bg-void-border hover:bg-void-purple text-void-text rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-void-cyan/15 hover:bg-void-cyan/20 text-void-text rounded font-semibold",children:d?"Saving...":"Save changes"})]})]})]})}):null},At=({activeTab:t,onTabChange:m})=>{const c=[{id:"overview",label:"Overview",icon:he},{id:"audit-logs",label:"Audit Logs",icon:We}];return e.jsx("div",{className:"flex items-center gap-1 border-b border-void-border pb-0 mb-6",children:c.map(f=>{const i=t===f.id,y=f.icon;return e.jsxs("button",{onClick:()=>m(f.id),className:`
                  relative px-4 py-3 text-sm font-medium transition-all duration-200 flex items-center gap-2 border-b-2
                  ${i?"text-void-cyan border-void-cyan":"text-void-muted hover:text-void-text border-transparent hover:border-void-muted/50"}
                `,children:[e.jsx(y,{className:"w-4 h-4"}),f.label]},f.id)})})},_t=({server:t})=>{const[m,c]=r.useState(""),[f,i]=r.useState([]),[y,d]=r.useState(!0),[l,x]=r.useState(null);r.useEffect(()=>{(async()=>{if(t?.id){d(!0),x(null);try{const h=await window.electronAPI.getAuditLogs(t.id);i(Array.isArray(h)?h:h?.logs||[])}catch(h){console.error("Failed to fetch audit logs:",h),x("Failed to load audit logs.")}finally{d(!1)}}})()},[t?.id]);const v=f.filter(u=>(u.action||"").toLowerCase().includes(m.toLowerCase())||(u.user||"").toLowerCase().includes(m.toLowerCase())||(u.details||"").toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-void-text flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-void-cyan"})," Audit Trail"]}),e.jsx("p",{className:"text-void-muted text-sm mt-1",children:"Track all interactions and changes made to this server."})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-void-muted"}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:m,onChange:u=>c(u.target.value),className:"pl-9 pr-4 py-2 bg-void-panel-2 border border-void-border rounded-lg text-sm text-void-text focus:border-void-cyan outline-none transition-colors w-64"})]})})]}),e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 px-6 py-3 bg-void-panel-2 border-b border-void-border text-xs font-semibold text-void-muted uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-2",children:"Time"}),e.jsx("div",{className:"col-span-2",children:"User"}),e.jsx("div",{className:"col-span-2",children:"Action"}),e.jsx("div",{className:"col-span-5",children:"Details"}),e.jsx("div",{className:"col-span-1 text-right",children:"Data"})]}),e.jsx("div",{className:"divide-y divide-void-border max-h-[600px] overflow-y-auto",children:y?e.jsx("div",{className:"p-8 text-center text-void-muted",children:"Loading audit logs..."}):l?e.jsx("div",{className:"p-8 text-center text-red-400",children:l}):v.length===0?e.jsxs("div",{className:"p-8 text-center text-void-muted",children:[e.jsx(ct,{className:"w-8 h-8 mx-auto mb-2 opacity-20"}),"No audit logs found matching your criteria."]}):v.map(u=>e.jsxs("div",{className:"grid grid-cols-12 px-6 py-4 items-center hover:bg-white/5 transition-colors group",children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-2 text-void-muted text-xs font-mono",children:[e.jsx(mt,{className:"w-3 h-3"}),new Date(u.created_at||u.timestamp).toLocaleString()]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-gradient-to-br from-void-purple to-blue-600 flex items-center justify-center text-[10px] text-white font-bold",children:(u.user||"?").substring(0,1).toUpperCase()}),e.jsx("span",{className:"text-sm text-void-text font-medium truncate",title:u.user,children:u.user})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:`
                    inline-flex items-center px-2 py-1 rounded text-[10px] font-bold border
                    ${(u.action||"").includes("START")?"bg-green-500/10 text-green-400 border-green-500/20":(u.action||"").includes("STOP")?"bg-red-500/10 text-red-400 border-red-500/20":(u.action||"").includes("EDIT")?"bg-blue-500/10 text-blue-400 border-blue-500/20":"bg-void-panel-2 text-void-muted border-void-border"}
                  `,children:u.action})}),e.jsx("div",{className:"col-span-5 text-sm text-void-muted truncate pr-4",title:u.details,children:u.details}),e.jsx("div",{className:"col-span-1 text-right",children:e.jsx("button",{className:"p-1.5 hover:bg-void-panel-2 rounded-md transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(xt,{className:"w-4 h-4 text-void-muted hover:text-void-cyan"})})})]},u.id))})]})]})},Lt=60;function Re(t){if(t==null)return"N/A";const m=["B","KB","MB","GB","TB"];let c=Number(t),f=0;for(;c>=1024&&f<m.length-1;)c/=1024,f+=1;return`${c.toFixed(f===0?0:2)} ${m[f]}`}function Et(t,m,c){const f=Number(t);return Number.isNaN(f)?m:Math.min(c,Math.max(m,f))}function $e(t,m=3){const c=Array.isArray(t)?t:[];if(c.length<3)return c;const f=Math.max(1,Math.floor(m)),i=Math.floor(f/2);return c.map((y,d)=>{let l=0,x=0;const v=Math.max(0,d-i),u=Math.min(c.length-1,d+i);for(let h=v;h<=u;h+=1){const C=Number(c[h]);Number.isNaN(C)||(l+=C,x+=1)}return x?l/x:0})}function Oe(t,m,c,f,i){const y=Array.isArray(t)?t:[];if(y.length<2)return"";const d=Number(f),l=Number(i),x=Math.max(1e-9,l-d),v=m/(y.length-1);return y.map((u,h)=>{const C=Et(u,d,l),A=h*v,S=c-(C-d)/x*c;return`${h===0?"M":"L"} ${A.toFixed(2)} ${S.toFixed(2)}`}).join(" ")}function Be(t,m,c){return t?`${t} L ${m.toFixed(2)} ${c.toFixed(2)} L 0 ${c.toFixed(2)} Z`:""}function fe(t){return t?String(t).replace(/\x1B\[[0-9;]*[A-Za-z]/g,"").replace(/\u001B\[[0-9;]*[A-Za-z]/g,""):""}async function Fe(t=5e3,m=250){const c=Date.now(),f=window.electronAPI?.config?.backendPort||"3456";for(;Date.now()-c<t;){try{if((await fetch(`http://localhost:${f}/api/health`)).ok)return!0}catch{}await new Promise(i=>setTimeout(i,m))}return!1}const Pt=({serverId:t,dockerReady:m=!0,onBack:c,onDeleted:f})=>{const i=ge(),[y,d]=r.useState(!0),[l,x]=r.useState(null),[v,u]=r.useState(null),[h,C]=r.useState([]),[A,S]=r.useState(!1),[I,p]=r.useState(!1),[R,_]=r.useState(!1),[s,o]=r.useState("overview"),[j,T]=r.useState(!0),[L,P]=r.useState([]),[te,F]=r.useState(""),[G,w]=r.useState(!1),[J,z]=r.useState(!1),[ie,V]=r.useState(null),[B,ne]=r.useState("terminal");r.useEffect(()=>{B==="terminal"&&re.current&&setTimeout(()=>{try{re.current.fit()}catch{}U.current?.focus()},50)},[B]);const se=r.useRef(null),U=r.useRef(null),re=r.useRef(null),Z=r.useRef(null),a=r.useRef(null),b=r.useRef(null);r.useRef([]),r.useRef(-1);const g=l?.status==="running",O=r.useMemo(()=>{const n=l?.metadata;if(!n)return{};try{const N=JSON.parse(n);return N&&typeof N=="object"?N:{}}catch{return{}}},[l?.metadata])?.last_stop,q=!g&&O&&O.type==="policy"&&O.reason,W=r.useMemo(()=>h.map(n=>n.cpu),[h]),ye=r.useMemo(()=>h.map(n=>n.memPct),[h]),we=r.useMemo(()=>$e(W,5),[W]),Se=r.useMemo(()=>$e(ye,5),[ye]),oe=r.useMemo(()=>Oe(we,240,90,0,100),[we]),ae=r.useMemo(()=>Oe(Se,240,90,0,100),[Se]),ke=r.useMemo(()=>Be(oe,240,90),[oe]),Ce=r.useMemo(()=>Be(ae,240,90),[ae]);r.useEffect(()=>{Z.current&&j&&(Z.current.scrollTop=Z.current.scrollHeight)},[L,j]),r.useEffect(()=>{let n=!1;return(async()=>{d(!0);try{const E=await window.electronAPI.getServer(t);n||x(E)}catch{n||x(null)}finally{n||d(!1)}})(),()=>{n=!0}},[t]),r.useEffect(()=>{let n=!0,N;return(async()=>{const k=await Fe(8e3,300);if(!n)return;if(!k){P(M=>[...M,{type:"system",text:"Backend is not reachable (console)"}]);return}const Q=`ws://localhost:${window.electronAPI?.config?.backendPort||"3456"}/api/servers/console?serverId=${encodeURIComponent(t)}`;N=new WebSocket(Q),b.current=N,N.onmessage=M=>{if(n)try{const H=JSON.parse(M.data);H.type==="output"?P(X=>[...X,{type:"stdout",text:fe(H.data??"")}]):H.type==="error"&&P(X=>[...X,{type:"stderr",text:fe(H.message??"Console error")}])}catch{P(H=>[...H,{type:"stdout",text:fe(String(M.data??""))}])}},N.onerror=()=>{n&&P(M=>[...M,{type:"system",text:"Console connection error"}])}})(),()=>{n=!1;try{N?.close()}catch{}}},[t]),r.useEffect(()=>{let n=!1,N;const E=async()=>{try{const k=await window.electronAPI.getServerResources(t);if(n)return;if(u(k),k?.status==="running"){const xe=typeof k.cpu?.usage=="number"?k.cpu.usage:0,Q=typeof k.memory?.percentage=="number"?k.memory.percentage:0;C(M=>[...M,{ts:Date.now(),cpu:xe,memPct:Q}].slice(-Lt))}}catch{n||u(null)}};return E(),N=setInterval(E,2e3),()=>{n=!0,N&&clearInterval(N)}},[t]),r.useEffect(()=>{if(V(null),w(!1),!se.current)return;const n=new yt.Terminal({cursorBlink:!0,fontSize:13,fontFamily:'"Cascadia Code", "Fira Code", "Roboto Mono", monospace',theme:{background:"#00000000",foreground:"#e5e7eb",cursor:"#06b6d4",selectionBackground:"rgba(6, 182, 212, 0.3)",black:"#1f2937",red:"#ef4444",green:"#10b981",yellow:"#f59e0b",blue:"#3b82f6",magenta:"#8b5cf6",cyan:"#06b6d4",white:"#f3f4f6"},allowProposedApi:!0}),N=new wt.FitAddon;n.loadAddon(N),n.open(se.current),setTimeout(()=>{try{N.fit()}catch{}n.focus()},100),U.current=n,re.current=N;let E=!0,k;const xe=async()=>{console.log(`[Terminal] Connecting to backend for server ${t}...`);const M=await Fe(8e3,300);if(!E)return;if(!M){console.error("[Terminal] Backend not reachable"),V("Backend is not reachable"),n.write(`\x1B[31mBACKEND UNREACHABLE\x1B[0m\r
`);return}const X=`ws://localhost:${window.electronAPI?.config?.backendPort||"3456"}/api/servers/terminal?serverId=${encodeURIComponent(t)}`;console.log(`[Terminal] WebSocket URL: ${X}`),k=new WebSocket(X),a.current=k,k.onopen=()=>{if(!E){try{k.close()}catch{}return}w(!0),V(null)},k.onmessage=ue=>{if(E)try{const pe=JSON.parse(ue.data);pe.type==="output"?n.write(pe.data??""):pe.type==="error"&&n.write(`\r
\x1B[31m${pe.message??"Terminal error"}\x1B[0m\r
`)}catch{n.write(ue.data??"")}},k.onerror=ue=>{E&&V("Terminal connection error")},k.onclose=ue=>{E&&w(!1)}};n.onData(M=>{M==="\r"?n.write(`\r
`):M===""?n.write("\b \b"):n.write(M),k&&k.readyState===WebSocket.OPEN&&k.send(JSON.stringify({type:"input",data:M}))}),xe();const Q=()=>{try{N.fit()}catch{}};return window.addEventListener("resize",Q),()=>{E=!1,window.removeEventListener("resize",Q);try{k?.close()}catch{}try{n.dispose()}catch{}}},[t,y]);const le=async()=>{try{const n=await window.electronAPI.getServer(t);x(n)}catch{}},$=(n,N="system")=>{P(E=>[...E,{type:N,text:n}]),U.current&&(N==="system"?(U.current.write(`\r
\x1B[35m[SYSTEM] ${n}\x1B[0m\r
`),a.current&&a.current.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"input",data:"\r"}))):N==="stderr"?(U.current.write(`\r
\x1B[31m[ERROR] ${n}\x1B[0m\r
`),a.current&&a.current.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"input",data:"\r"}))):U.current.write(n))},He=async()=>{p(!0);try{if(String(l?.execution_mode||"native").toLowerCase()==="docker"&&!m){$("Docker engine is not ready. Start Docker Desktop first.","stderr");return}const N=window.electronAPI?.config?.backendPort||"3456";$("Running install command...","system");const E=await fetch(`http://localhost:${N}/api/servers/${t}/install`,{method:"POST"}),k=await E.json().catch(()=>({}));if(!E.ok)throw new Error(k.error||"Failed to run install");$(`Install finished (code ${k.code})`,"system")}catch(n){$(`Install failed: ${n.message}`,"stderr")}finally{p(!1)}},Ze=async()=>{S(!0),$("Starting server...","system");try{if(String(l?.execution_mode||"native").toLowerCase()==="docker"&&!m)throw new Error("Docker engine is not ready. Start Docker Desktop first.");await window.electronAPI.startServer(t),await le(),$("Server start command issued.","system")}catch(n){$(`Start failed: ${n.message}`,"stderr")}finally{S(!1)}},Ke=async()=>{S(!0),$("Stopping server...","system");try{if(String(l?.execution_mode||"native").toLowerCase()==="docker"&&!m)throw new Error("Docker engine is not ready. Start Docker Desktop first.");await window.electronAPI.stopServer(t),await le(),$("Server stop command issued.","system")}catch(n){$(`Stop failed: ${n.message}`,"stderr")}finally{S(!1)}},Qe=async()=>{S(!0),$("Restarting server...","system");try{if(String(l?.execution_mode||"native").toLowerCase()==="docker"&&!m)throw new Error("Docker engine is not ready. Start Docker Desktop first.");await window.electronAPI.restartServer(t),setTimeout(()=>le(),1200),$("Server restart command issued.","system")}catch(n){$(`Restart failed: ${n.message}`,"stderr")}finally{S(!1)}},Xe=async()=>{if(await i.confirm("Are you sure you want to delete this server?")){S(!0);try{await window.electronAPI.deleteServer(t),typeof f=="function"&&f(t),typeof c=="function"&&c()}catch(n){console.error("Failed to delete server:",n),i.error(n?.message||"Failed to delete server")}finally{S(!1)}}};if(y)return e.jsx("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:e.jsx("div",{className:"text-void-muted",children:"Loading server..."})});if(!l||l?.error)return e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:c,className:"px-3 py-2 bg-void-border hover:bg-void-purple text-void-text rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"})," Back"]})}),e.jsxs("div",{className:"mt-4 text-red-400 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"})," Server not found"]})]});const Ae=typeof v?.cpu?.usage=="number"?v.cpu.usage:0,Ye=typeof v?.memory?.percentage=="number"?v.memory.percentage:0,_e=typeof v?.memory?.rss=="number"?v.memory.rss:0,et=v?.pid||l?.pid||"N/A",Le=typeof v?.disk?.server_used_bytes=="number"?v.disk.server_used_bytes:0;typeof v?.disk?.total=="number"&&v.disk.total;const Ee=!!l?.isolation_enabled,de=l?.cpu_limit_percent??null,ce=l?.memory_limit_mb??null,K=l?.disk_limit_mb??null,tt=l?.runtime_preset||"",Pe=l?.install_command||"",st=l?.start_command||"",rt=String(l?.type||"").startsWith("template:"),ot=String(l?.type||"").startsWith("egg:"),at=!!(Pe||rt||ot),me=String(l?.execution_mode||"native").toLowerCase()==="docker"&&!m;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:c,className:"p-2 hover:bg-white/5 rounded-lg text-void-muted hover:text-void-text transition-colors",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-void-text flex items-center gap-3",children:[l.name,e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${g?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,children:g?"Running":"Stopped"})]}),e.jsx("div",{className:"text-sm text-void-muted font-mono mt-0.5 max-w-md truncate",title:l.path,children:l.path})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[at&&e.jsxs("button",{onClick:He,disabled:I||g||me,className:"px-4 py-2 bg-void-panel-2 hover:bg-white/5 border border-void-border rounded-lg text-sm font-medium text-void-text transition-colors flex items-center gap-2",children:[I?e.jsx(je,{className:"w-4 h-4 animate-spin"}):e.jsx(he,{className:"w-4 h-4"}),"Install"]}),e.jsxs("button",{onClick:Ze,disabled:A||g||me,className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${g?"bg-green-500/10 text-green-400 border border-green-500/20 opacity-50 cursor-not-allowed":"bg-green-500 text-black hover:bg-green-400 shadow-lg shadow-green-500/20"}`,children:[e.jsx(Ge,{className:"w-4 h-4 fill-current"})," Start"]}),e.jsxs("button",{onClick:Ke,disabled:A||!g||me,className:"px-4 py-2 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-lg text-sm font-medium text-red-400 transition-colors flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 fill-current"})," Stop"]}),e.jsxs("button",{onClick:Qe,disabled:A||me,className:"px-4 py-2 bg-yellow-500/10 hover:bg-yellow-500/20 border border-yellow-500/20 rounded-lg text-sm font-medium text-yellow-400 transition-colors flex items-center gap-2",children:[e.jsx(je,{className:`w-4 h-4 ${A?"animate-spin":""}`})," Restart"]}),e.jsx("div",{className:"h-6 w-px bg-void-border mx-2"}),e.jsx("button",{onClick:()=>_(!0),className:"p-2 hover:bg-white/5 rounded-lg text-void-muted hover:text-void-text transition-colors",children:e.jsx(ut,{className:"w-5 h-5"})}),e.jsx("button",{onClick:Xe,disabled:g,className:"p-2 hover:bg-red-500/10 rounded-lg text-void-muted hover:text-red-400 transition-colors",children:e.jsx(Je,{className:"w-5 h-5"})})]})]}),e.jsx(At,{activeTab:s,onTabChange:o}),R&&e.jsx(Ve,{server:l,onClose:()=>_(!1),onSaved:async()=>{_(!1),await le()}}),e.jsxs("div",{style:{display:s==="overview"?"block":"none"},className:"space-y-6",children:[q?e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-red-300 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-void-text font-semibold",children:"Server stopped due to resource limits"}),e.jsx("div",{className:"text-sm text-red-200 mt-1 break-words",children:String(O.reason)}),e.jsx("div",{className:"text-xs text-void-muted mt-2",children:"Adjust CPU/RAM limits and start the server again."})]})]})}):null,e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-2xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-void-border bg-void-panel-2",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-void-text font-bold",children:[e.jsx(he,{className:"w-5 h-5 text-void-cyan"}),e.jsx("span",{className:"tracking-tight",children:"Server Station"})]}),e.jsxs("div",{className:"flex items-center bg-black/40 p-1 rounded-lg border border-white/5",children:[e.jsx("button",{onClick:()=>ne("terminal"),className:`px-4 py-1.5 rounded-md text-xs font-semibold transition-all ${B==="terminal"?"bg-void-cyan/10 text-void-cyan border border-void-cyan/20":"text-void-muted hover:text-void-muted border border-transparent"}`,children:"Terminal"}),e.jsx("button",{onClick:()=>ne("console"),className:`px-4 py-1.5 rounded-md text-xs font-semibold transition-all ${B==="console"?"bg-void-cyan/10 text-void-cyan border border-void-cyan/20":"text-void-muted hover:text-void-muted border border-transparent"}`,children:"Console"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest ${G?"text-green-400":"text-red-400"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full animate-pulse ${G?"bg-green-400":"bg-red-400"}`}),G?"Session Active":"Offline"]}),e.jsx("div",{className:"h-4 w-px bg-void-border"}),e.jsx("button",{onClick:()=>{B==="terminal"?U.current?.clear():P([])},className:"px-3 py-1.5 bg-void-panel-2 hover:bg-white/10 border border-void-border text-void-text rounded-lg transition-colors text-xs font-semibold",children:"Clear"})]})]}),e.jsx("div",{className:"p-1 bg-[#0a0a0a]",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-void-cyan/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-3xl pointer-events-none"}),e.jsx("div",{className:`h-[400px] transition-all duration-300 ${B==="terminal"?"block":"hidden"}`,style:{padding:"16px"},children:e.jsx("div",{ref:se,className:"h-full w-full"})}),e.jsx("div",{className:`h-[400px] overflow-y-auto bg-black/40 p-4 font-mono text-[13px] leading-relaxed transition-all duration-300 ${B==="console"?"block":"hidden"}`,ref:Z,children:L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-void-muted gap-3",children:[e.jsx(pt,{className:"w-8 h-8 opacity-20"}),e.jsx("div",{className:"text-sm",children:"No console logs available for this session."})]}):L.map((n,N)=>e.jsxs("div",{className:`whitespace-pre-wrap flex gap-3 py-0.5 border-l-2 pl-3 transition-colors ${n.type==="stderr"?"text-red-400 border-red-500/50 bg-red-500/5":n.type==="system"?"text-void-purple border-void-purple/50 bg-void-purple/5":"text-void-muted border-transparent hover:bg-void-panel-2"}`,children:[e.jsx("span",{className:"opacity-30 select-none text-[10px] w-8 text-right mt-1",children:N+1}),e.jsx("span",{className:"flex-1",children:n.text})]},N))})]})}),e.jsxs("div",{className:"px-6 py-3 border-t border-void-border bg-void-panel-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-void-muted uppercase font-bold tracking-wider",children:"Storage"}),e.jsxs("span",{className:"text-xs text-void-muted font-mono",children:[(Le/(1024*1024)).toFixed(1)," / ",K?`${K} MB`:"∞"]})]}),e.jsx("div",{className:"h-6 w-px bg-void-border"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-void-muted uppercase font-bold tracking-wider",children:"Memory"}),e.jsxs("span",{className:"text-xs text-void-muted font-mono",children:[(_e/(1024*1024)).toFixed(1)," / ",ce?`${ce} MB`:"∞"]})]}),e.jsx("div",{className:"h-6 w-px bg-void-border"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-void-muted uppercase font-bold tracking-wider",children:"CPU"}),e.jsxs("span",{className:"text-xs text-void-muted font-mono",children:[Ae.toFixed(1),"% / ",de?`${de}%`:"∞"]})]})]}),e.jsxs("div",{className:"text-[10px] text-void-muted font-mono",children:[ie&&e.jsx("span",{className:"text-red-500/80 mr-3",children:ie}),"TURBONOX SHELL v1.0 • ",String(t||"").slice(0,8)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-void-muted",children:[e.jsx(bt,{className:"w-5 h-5 text-void-muted"})," Status"]}),e.jsx("div",{className:"px-2.5 py-1 rounded-full text-xs font-semibold border "+(g?"bg-green-500/10 text-green-300 border-green-500/20":"bg-gray-500/10 text-void-muted border-gray-500/20"),children:g?"Running":"Stopped"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:[e.jsx("div",{className:"text-void-muted",children:"PID"}),e.jsx("div",{className:"text-void-muted font-mono mt-1",children:et})]}),e.jsxs("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:[e.jsx("div",{className:"text-void-muted",children:"Last update"}),e.jsx("div",{className:"text-void-muted mt-1",children:v?.timestamp?new Date(v.timestamp).toLocaleTimeString():"N/A"})]})]}),e.jsx("div",{className:"mt-3 text-xs text-void-muted",children:"If a server exceeds its configured limits, Turbonox will stop it automatically."})]}),e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6 lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-void-muted",children:[e.jsx(ee,{className:"w-5 h-5 text-void-cyan"})," Isolation & Limits"]}),e.jsx("div",{className:"px-2.5 py-1 rounded-full text-xs font-semibold border "+(Ee?"bg-void-cyan/10 text-void-cyan border-void-cyan/20":"bg-gray-500/10 text-void-muted border-gray-500/20"),children:Ee?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-void-muted",children:"CPU limit"}),e.jsx("span",{className:"text-void-muted font-mono",children:de?`${Number(de)}%`:"Unlimited"})]})}),e.jsx("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-void-muted",children:"RAM limit"}),e.jsx("span",{className:"text-void-muted font-mono",children:ce?`${Number(ce)} MB`:"Unlimited"})]})}),e.jsx("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-void-muted",children:"Disk limit"}),e.jsx("span",{className:"text-void-muted font-mono",children:K?`${Number(K)} MB`:"Unlimited"})]})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:[e.jsx("div",{className:"text-void-muted text-xs",children:"Runtime preset"}),e.jsx("div",{className:"text-void-muted font-mono text-xs mt-1 break-all",children:tt||"—"})]}),e.jsxs("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:[e.jsx("div",{className:"text-void-muted text-xs",children:"Install command"}),e.jsx("div",{className:"text-void-muted font-mono text-xs mt-1 break-all",children:Pe||"—"})]}),e.jsxs("div",{className:"bg-void-panel-2 border border-void-border rounded-lg p-3",children:[e.jsx("div",{className:"text-void-muted text-xs",children:"Managed start"}),e.jsx("div",{className:"text-void-muted font-mono text-xs mt-1 break-all",children:st||"—"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-void-muted",children:[e.jsx(vt,{className:"w-5 h-5 text-blue-400"})," CPU"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-300",children:[Ae.toFixed(1),"%"]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("svg",{viewBox:"0 0 240 90",className:"w-full h-[100px] text-blue-400",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"cpuGrad",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.35"}),e.jsx("stop",{offset:"50%",stopColor:"currentColor",stopOpacity:"1"}),e.jsx("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0.35"})]}),e.jsxs("linearGradient",{id:"cpuFill",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.22"}),e.jsx("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0"})]})]}),e.jsx("path",{d:"M 0 67.5 L 240 67.5",fill:"none",stroke:"currentColor",strokeOpacity:"0.10",strokeWidth:"1"}),e.jsx("path",{d:"M 0 45 L 240 45",fill:"none",stroke:"currentColor",strokeOpacity:"0.10",strokeWidth:"1"}),e.jsx("path",{d:"M 0 22.5 L 240 22.5",fill:"none",stroke:"currentColor",strokeOpacity:"0.10",strokeWidth:"1"}),ke?e.jsx("path",{d:ke,fill:"url(#cpuFill)"}):null,oe?e.jsx("path",{d:oe,fill:"none",stroke:"url(#cpuGrad)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}):null,oe?null:e.jsx("text",{x:"120",y:"50",textAnchor:"middle",fill:"currentColor",fillOpacity:"0.35",fontSize:"10",children:"Waiting for data..."})]})})]}),e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-void-muted",children:[e.jsx(ht,{className:"w-5 h-5 text-green-400"})," Memory"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-300",children:[Ye.toFixed(1),"%"]})]}),e.jsxs("div",{className:"mt-2 text-sm text-void-muted",children:["RSS: ",Re(_e)]}),e.jsx("div",{className:"mt-2",children:e.jsxs("svg",{viewBox:"0 0 240 90",className:"w-full h-[100px] text-green-400",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"memGrad",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.35"}),e.jsx("stop",{offset:"50%",stopColor:"currentColor",stopOpacity:"1"}),e.jsx("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0.35"})]}),e.jsxs("linearGradient",{id:"memFill",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.22"}),e.jsx("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0"})]})]}),e.jsx("path",{d:"M 0 67.5 L 240 67.5",fill:"none",stroke:"currentColor",strokeOpacity:"0.10",strokeWidth:"1"}),e.jsx("path",{d:"M 0 45 L 240 45",fill:"none",stroke:"currentColor",strokeOpacity:"0.10",strokeWidth:"1"}),e.jsx("path",{d:"M 0 22.5 L 240 22.5",fill:"none",stroke:"currentColor",strokeOpacity:"0.10",strokeWidth:"1"}),Ce?e.jsx("path",{d:Ce,fill:"url(#memFill)"}):null,ae?e.jsx("path",{d:ae,fill:"none",stroke:"url(#memGrad)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}):null,ae?null:e.jsx("text",{x:"120",y:"50",textAnchor:"middle",fill:"currentColor",fillOpacity:"0.35",fontSize:"10",children:"Waiting for data..."})]})})]})]}),e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-void-text font-bold",children:[e.jsx(gt,{className:"w-5 h-5 text-void-cyan"})," Disk"]}),e.jsxs("div",{className:"text-sm text-void-muted font-mono",children:[Re(Le)," / ",K?`${Number(K)} MB`:"Unlimited"]})]}),e.jsx("div",{className:"mt-2 text-xs text-void-muted",children:"Shows disk usage for this server folder (total size of files inside it)."})]})]}),s==="audit-logs"&&e.jsx(_t,{server:l})]})},Ft=({dockerReady:t=!0,cloudUser:m,cloudPlan:c,activeNodeId:f="local"})=>{const i=ge(),y=r.useMemo(()=>{if(!m)return!1;if(m.is_restricted)return!0;try{const a=typeof m.restricted_features=="string"?JSON.parse(m.restricted_features):m.restricted_features;if(Array.isArray(a)&&a.includes("create_instance"))return!0}catch{}return!1},[m]),[d,l]=r.useState([]),[x,v]=r.useState([]),[u,h]=r.useState(!1),[C,A]=r.useState(null),[S,I]=r.useState(null),[p,R]=r.useState(null),[_,s]=r.useState(""),[o,j]=r.useState("all"),[T,L]=r.useState("all"),[P,te]=r.useState("recent"),[F,G]=r.useState(!1);r.useEffect(()=>{w(),B()},[]),r.useEffect(()=>{const a=()=>{w(),B()};return window.addEventListener("void-active-account-changed",a),()=>{window.removeEventListener("void-active-account-changed",a)}},[]);const w=async()=>{try{const a=await window.electronAPI.getServers();l(Array.isArray(a)?a:[])}catch(a){console.error("Failed to fetch servers:",a),l([])}},J=async()=>{G(!0);try{await Promise.all([w(),B()])}finally{G(!1)}},z=r.useMemo(()=>{const a=Array.isArray(d)?d:[],b=a.length,g=a.filter(W=>W.status==="running").length,D=b-g,O=a.filter(W=>!!W.public_access).length,q=a.filter(W=>!!W.isolation_enabled).length;return{total:b,running:g,stopped:D,publicCount:O,isolated:q}},[d]),ie=r.useMemo(()=>{const a=new Set((d||[]).map(b=>b.type).filter(Boolean));return Array.from(a).sort()},[d]),V=r.useMemo(()=>{const a=(_||"").trim().toLowerCase();let b=Array.isArray(d)?d.slice():[];return a&&(b=b.filter(g=>{const D=String(g?.name||"").toLowerCase(),O=String(g?.path||"").toLowerCase(),q=String(g?.type||"").toLowerCase(),W=String(g?.subdomain||"").toLowerCase();return D.includes(a)||O.includes(a)||q.includes(a)||W.includes(a)})),o!=="all"&&(b=b.filter(g=>o==="running"?g.status==="running":g.status!=="running")),T!=="all"&&(b=b.filter(g=>String(g.type||"")===T)),P==="name"?b.sort((g,D)=>String(g?.name||"").localeCompare(String(D?.name||""))):P==="status"?b.sort((g,D)=>{const O=g?.status==="running"?0:1,q=D?.status==="running"?0:1;return O-q}):b.sort((g,D)=>{const O=g?.created_at?Number(new Date(g.created_at)):0;return(D?.created_at?Number(new Date(D.created_at)):0)-O}),b},[d,_,o,T,P]),B=async()=>{try{const a=await window.electronAPI.getNodes(),b=Array.isArray(a)?a:[];b.push({id:"cloud-hosting",name:"Turbonox Cloud (Enterprise)",status:"online",is_cloud:!0,ip_address:"cloud.turbonox.xyz",port:443,requires_pro:!c?.cloud_hosting}),v(b)}catch(a){console.error("Failed to fetch nodes:",a),v([{id:"cloud-hosting",name:"Turbonox Cloud (Enterprise)",status:"online",is_cloud:!0,ip_address:"cloud.turbonox.xyz",port:443,requires_pro:!c?.cloud_hosting}])}},ne=async a=>{try{const b=(d||[]).find(D=>String(D?.id)===String(a));if(String(b?.execution_mode||"native").toLowerCase()==="docker"&&!t){i.alert("Docker engine is not ready. Start Docker Desktop first.");return}await window.electronAPI.startServer(a),w()}catch(b){console.error("Failed to start server:",b)}},se=async a=>{try{const b=(d||[]).find(D=>String(D?.id)===String(a));if(String(b?.execution_mode||"native").toLowerCase()==="docker"&&!t){i.alert("Docker engine is not ready. Start Docker Desktop first.");return}await window.electronAPI.stopServer(a),w()}catch(b){console.error("Failed to stop server:",b)}},U=async a=>{try{const b=(d||[]).find(D=>String(D?.id)===String(a));if(String(b?.execution_mode||"native").toLowerCase()==="docker"&&!t){i.alert("Docker engine is not ready. Start Docker Desktop first.");return}await window.electronAPI.restartServer(a),setTimeout(()=>w(),1500)}catch(b){console.error("Failed to restart server:",b)}},re=async a=>{if(await i.confirm("Are you sure you want to delete this server?"))try{await window.electronAPI.deleteServer(a),w()}catch(b){console.error("Failed to delete server:",b)}},Z=async a=>{try{await window.electronAPI.createServer(a),h(!1),w()}catch(b){console.error("Failed to create server:",b)}};return y?e.jsx(St,{title:"Server Creation Restricted",description:"Access to server creation and management features has been restricted for your account."}):p?e.jsx(Pt,{serverId:p,dockerReady:t,onBack:()=>{R(null),w()},onDeleted:()=>{R(null),w()}},p):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-void-text",children:"Server Manager"}),c?.tier==="pro"?e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-1 rounded-full border border-void-purple/30 bg-void-purple/5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-void-purple animate-pulse"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-void-purple",children:"Cloud Enabled"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-1 rounded-full border border-zinc-800 bg-zinc-900/50",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-zinc-600"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-zinc-500",children:"Requires Pro"})]})]}),e.jsxs("p",{className:"text-void-muted text-sm mt-1",children:["Deploy, monitor, and scale your application instances ",c?.tier==="pro"?"on-premise and in the cloud.":"locally."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:J,disabled:F,className:"px-4 py-2 bg-white/5 hover:bg-white/10 border border-void-border text-void-text rounded-none transition-colors text-sm font-mono tracking-wide flex items-center gap-2 disabled:opacity-50",title:"Refresh",children:[e.jsx(ft,{className:`w-3.5 h-3.5 ${F?"animate-spin":""}`})," REFRESH"]}),e.jsxs("button",{onClick:()=>h(!0),disabled:y,className:`px-5 py-2 border rounded-none text-sm font-mono tracking-wide transition-all flex items-center gap-2 ${y?"bg-red-500/10 border-red-500/20 text-red-400 cursor-not-allowed grayscale-[0.5]":"bg-void-cyan/15 hover:bg-void-cyan/20 border-void-cyan/20 text-void-text hover:text-white"}`,title:y?"Creation restricted by administrator":"Deploy new server",children:[y?e.jsx(ee,{className:"w-3.5 h-3.5"}):e.jsx(Me,{className:"w-3.5 h-3.5"}),"NEW SERVER"]})]})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-2 md:grid-cols-5 gap-0 border border-void-border",children:[e.jsxs("div",{className:"bg-black p-4 border-r border-void-border",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-void-muted font-mono mb-1",children:"Total"}),e.jsx("div",{className:"text-void-text text-xl font-bold font-mono",children:z.total})]}),e.jsxs("div",{className:"bg-black p-4 border-r border-void-border",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-void-muted font-mono mb-1",children:"Active"}),e.jsx("div",{className:"text-purple-400 text-xl font-bold font-mono",children:z.running})]}),e.jsxs("div",{className:"bg-black p-4 border-r border-void-border",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-void-muted font-mono mb-1",children:"Inactive"}),e.jsx("div",{className:"text-void-muted text-xl font-bold font-mono",children:z.stopped})]}),e.jsxs("div",{className:"bg-black p-4 border-r border-void-border",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-void-muted font-mono mb-1",children:"Public"}),e.jsx("div",{className:"text-void-text text-xl font-bold font-mono",children:z.publicCount})]}),e.jsxs("div",{className:"bg-black p-4",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-void-muted font-mono mb-1",children:"Isolated"}),e.jsx("div",{className:"text-void-text text-xl font-bold font-mono",children:z.isolated})]})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-1 lg:grid-cols-12 gap-3",children:[e.jsx("div",{className:"lg:col-span-5",children:e.jsxs("div",{className:"flex items-center gap-2 bg-void-panel-2 border border-void-border rounded-lg px-3 py-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-void-muted"}),e.jsx("input",{value:_,onChange:a=>s(a.target.value),placeholder:"Search by name, type, path...",className:"w-full bg-transparent outline-none text-void-muted text-sm"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 bg-void-panel-2 border border-void-border rounded-lg px-3 py-2",children:[e.jsx(be,{className:"w-4 h-4 text-void-muted"}),e.jsx(ve,{value:o,minWidthClass:"",className:"w-full",options:[{value:"all",label:"All"},{value:"running",label:"Running"},{value:"stopped",label:"Stopped"}],onChange:a=>j(a)})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 bg-void-panel-2 border border-void-border rounded-lg px-3 py-2",children:[e.jsx(be,{className:"w-4 h-4 text-void-muted"}),e.jsx(ve,{value:T,minWidthClass:"",className:"w-full",options:[{value:"all",label:"All types"},...ie.map(a=>({value:a,label:a}))],onChange:a=>L(a)})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2 bg-void-panel-2 border border-void-border rounded-lg px-3 py-2",children:[e.jsx(be,{className:"w-4 h-4 text-void-muted"}),e.jsx(ve,{value:P,minWidthClass:"",className:"w-full",options:[{value:"recent",label:"Sort: Recent"},{value:"name",label:"Sort: Name"},{value:"status",label:"Sort: Status"}],onChange:a=>te(a)})]})})]})]}),d.length===0?e.jsxs("div",{className:"py-24 flex flex-col items-center text-center bg-black border border-void-border mt-4",children:[e.jsx("div",{className:"w-20 h-20 border border-void-border bg-void-panel mb-8 flex items-center justify-center",children:e.jsx(Y,{className:"w-10 h-10 text-void-muted"})}),e.jsx("h3",{className:"text-xl font-bold text-void-text mb-2 uppercase tracking-wide font-mono",children:"No Servers Configured"}),e.jsx("p",{className:"text-void-muted max-w-md mx-auto text-sm mb-12 font-mono",children:"Deploy your first instance to start hosting applications."}),e.jsxs("button",{onClick:()=>h(!0),className:"px-8 py-4 bg-purple-600 hover:bg-purple-700 text-white border border-transparent hover:border-purple-400 font-bold font-mono uppercase tracking-wider text-sm transition-all flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"Deploy First Server"})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-void-border w-64 flex justify-between text-[10px] text-void-muted font-mono uppercase tracking-widest",children:[e.jsx("span",{children:"Node.js"}),e.jsx("span",{children:"Python"}),e.jsx("span",{children:"Docker"})]})]}):V.length===0?e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl p-12 text-center",children:[e.jsx(Ne,{className:"w-12 h-12 text-void-muted mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-void-text",children:"No matches found"}),e.jsx("p",{className:"text-void-muted mt-2",children:"Adjust your search or filters to find what you're looking for."}),e.jsx("div",{className:"mt-6 flex items-center justify-center gap-2",children:e.jsx("button",{onClick:()=>{s(""),j("all"),L("all"),te("recent")},className:"px-5 py-2 bg-void-panel-2 hover:bg-white/10 border border-void-border text-void-text rounded-lg transition-colors font-medium",children:"Clear all filters"})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:V.map(a=>e.jsx(kt,{server:a,dockerReady:t,onStart:()=>ne(a.id),onStop:()=>se(a.id),onRestart:()=>U(a.id),onDelete:()=>re(a.id),onViewLogs:()=>A(a),onOpen:()=>R(a.id),onEdit:()=>I(a)},a.id))}),u&&e.jsx(Ct,{onClose:()=>h(!1),onCreate:Z,nodes:x,cloudUser:m,serverCount:Array.isArray(d)?d.length:0}),C&&e.jsx(Dt,{server:C,onClose:()=>A(null)}),S&&e.jsx(Ve,{server:S,onClose:()=>I(null),onSaved:()=>{I(null),w()}})]})},Dt=({server:t,onClose:m})=>{const[c,f]=r.useState([]),[i,y]=r.useState(!1),[d,l]=r.useState(""),[x,v]=r.useState(null),[u,h]=r.useState(""),[C,A]=r.useState("ai"),[S,I]=r.useState(!1);r.useEffect(()=>{p();const o=setInterval(p,2e3);return()=>{clearInterval(o)}},[t.id]);const p=async()=>{try{const o=await window.electronAPI.getServerLogs(t.id);f(o.logs||[])}catch(o){console.error("Failed to fetch logs:",o)}},R=async()=>{if(l(""),v(null),!window?.electronAPI||typeof window.electronAPI.analyzeServerLogs!="function"){l("AI Analyzer is not available. Fully restart the Electron app (preload changes require restart).");return}y(!0);try{const o=await window.electronAPI.analyzeServerLogs(t.id,{instructions:u,logLines:c});v(o?.result||null)}catch(o){l(o?.message||"AI analysis failed")}finally{y(!1)}},_=async o=>{try{await navigator.clipboard.writeText(String(o||""))}catch(j){console.error("Failed to copy:",j)}},s=async o=>{try{if(o==="restart_server"){await window.electronAPI.restartServer(t.id);return}if(o==="stop_server"){await window.electronAPI.stopServer(t.id);return}if(o==="start_server"){await window.electronAPI.startServer(t.id);return}}catch(j){console.error("Failed to execute suggested action:",j)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4","data-modal-scroll":"true",onWheel:o=>o.stopPropagation(),onWheelCapture:o=>o.stopPropagation(),children:e.jsxs("div",{className:"bg-void-panel border border-void-border rounded-xl w-full max-w-4xl max-h-[80vh] flex flex-col min-h-0",children:[e.jsxs("div",{className:"p-6 border-b border-void-border flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-void-text",children:["Server Logs - ",t.name]}),e.jsx("button",{onClick:m,className:"text-void-muted hover:text-void-text text-2xl",children:"×"})]}),e.jsxs("div",{className:"p-6 border-b border-void-border bg-void-bg",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-void-text font-semibold flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-void-cyan"})," AI Log Analyzer"]}),e.jsx("div",{className:"text-xs text-void-muted mt-1",children:"Analyze the current log window and get likely causes + fixes. Uses Groq with OpenRouter fallback."})]}),e.jsxs("button",{onClick:()=>_((c||[]).join(`
`)),className:"px-3 py-2 bg-void-panel-2 hover:bg-white/10 border border-void-border text-void-text rounded-lg transition-colors text-xs flex items-center gap-2",title:"Copy logs",children:[e.jsx(jt,{className:"w-4 h-4"})," Copy"]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-12 gap-3",children:[e.jsx("div",{className:"lg:col-span-9",children:e.jsx("input",{value:u,onChange:o=>h(o.target.value),placeholder:"Optional: add context (e.g. 'This is a Node app behind Cloudflared', 'I just changed ports', etc.)",className:"w-full bg-void-panel-2 border border-void-border rounded-lg px-3 py-2 text-void-muted text-sm outline-none"})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("button",{onClick:R,children:[S?e.jsx(ee,{className:"w-4 h-4 text-red-400"}):e.jsx(Te,{className:`w-4 h-4 ${i?"animate-pulse":""}`}),i?"ANALYZING":S?"RESTRICTED":"ANALYZE LOGS"]})})]}),d&&e.jsxs("div",{className:"mt-4 p-3 border border-red-900/50 bg-red-900/20 text-red-200 text-sm font-mono flex items-start gap-2",children:[e.jsx(qe,{className:"w-4 h-4 mt-0.5"}),e.jsx("div",{className:"flex-1",children:d})]})]}),e.jsx("div",{className:"px-6 pt-4 bg-void-bg border-b border-void-border",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A("ai"),className:`px-4 py-2 text-xs font-mono uppercase tracking-wide border-b-2 transition-colors ${C==="ai"?"border-purple-500 text-purple-400":"border-transparent text-void-muted hover:text-void-text"}`,children:"AI Analysis"}),e.jsx("button",{onClick:()=>A("logs"),className:`px-4 py-2 text-xs font-mono uppercase tracking-wide border-b-2 transition-colors ${C==="logs"?"border-purple-500 text-purple-400":"border-transparent text-void-muted hover:text-void-text"}`,children:"Raw Logs"})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-6 bg-void-bg text-sm overscroll-contain",onWheel:o=>o.stopPropagation(),onWheelCapture:o=>o.stopPropagation(),children:C==="ai"?x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-void-panel-2 border border-void-border rounded-lg",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:"Summary"}),e.jsx("div",{className:"text-sm text-void-muted mt-2 whitespace-pre-wrap",children:x.summary||"No summary returned."})]}),Array.isArray(x.likely_causes)&&x.likely_causes.length>0&&e.jsxs("div",{className:"p-4 bg-void-panel-2 border border-void-border rounded-lg",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:"Likely causes"}),e.jsx("div",{className:"mt-3 space-y-3",children:x.likely_causes.map((o,j)=>e.jsxs("div",{className:"border border-void-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:o?.title||"Cause"}),typeof o?.confidence=="number"&&e.jsxs("div",{className:"text-xs text-void-muted font-mono",children:[Math.round(o.confidence*100),"%"]})]}),Array.isArray(o?.evidence)&&o.evidence.length>0&&e.jsx("div",{className:"mt-2 text-xs text-void-muted space-y-1 font-mono",children:o.evidence.map((T,L)=>e.jsx("div",{className:"whitespace-pre-wrap",children:T},L))})]},j))})]}),Array.isArray(x.recommended_fixes)&&x.recommended_fixes.length>0&&e.jsxs("div",{className:"p-4 bg-void-panel-2 border border-void-border rounded-lg",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:"Recommended fixes"}),e.jsx("div",{className:"mt-3 space-y-3",children:x.recommended_fixes.map((o,j)=>e.jsxs("div",{className:"border border-void-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:o?.title||"Fix"}),o?.risk&&e.jsxs("div",{className:"text-xs text-void-muted",children:["Risk: ",String(o.risk)]})]}),Array.isArray(o?.steps)&&o.steps.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:o.steps.map((T,L)=>e.jsxs("div",{className:"text-sm text-void-muted",children:[L+1,". ",T]},L))})]},j))})]}),Array.isArray(x.suggested_actions)&&x.suggested_actions.length>0&&e.jsxs("div",{className:"p-4 bg-void-panel-2 border border-void-border rounded-lg",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:"Suggested actions"}),e.jsx("div",{className:"mt-3 space-y-2",children:x.suggested_actions.map((o,j)=>e.jsxs("div",{className:"flex items-center justify-between gap-3 border border-void-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:o?.action||"none"}),e.jsx("div",{className:"text-xs text-void-muted mt-1",children:o?.reason||""})]}),["restart_server","start_server","stop_server"].includes(String(o?.action))?e.jsxs("button",{onClick:()=>s(String(o?.action)),className:"px-3 py-2 bg-void-panel-2 hover:bg-white/10 border border-void-border text-void-text rounded-lg transition-colors text-xs flex items-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4"})," Run"]}):e.jsx("div",{className:"text-xs text-void-muted",children:"No action"})]},j))})]}),Array.isArray(x.questions)&&x.questions.length>0&&e.jsxs("div",{className:"p-4 bg-void-panel-2 border border-void-border rounded-lg",children:[e.jsx("div",{className:"text-sm text-void-text font-semibold",children:"Questions"}),e.jsx("div",{className:"mt-2 space-y-1",children:x.questions.map((o,j)=>e.jsxs("div",{className:"text-sm text-void-muted",children:["- ",o]},j))})]})]}):e.jsx("div",{className:"text-void-muted",children:"Run an analysis to see the full report here."}):e.jsx("div",{className:"font-mono",children:c.length===0?e.jsx("p",{className:"text-void-muted",children:"No logs available"}):c.map((o,j)=>e.jsx("div",{className:"text-void-muted whitespace-pre-wrap",children:o},j))})})]})})};export{Ft as default};
