import{j as e}from"./markdown-Bat84yML.js";import{r as o,R as D,H as P,u as M,t as F,y as z,V as U,aB as B,ak as L,j as A,b as E,i as J,an as q,J as K,au as V,z as $}from"./lucide-Bfyd0ICn.js";import"./react-vendor-N--QU9DW.js";const G=[{id:"general",label:"General Inquiry"},{id:"billing",label:"Billing & Account"},{id:"technical",label:"Technical Issue"},{id:"abuse",label:"Report Abuse"},{id:"feature",label:"Feature Request"}],T={open:"text-green-400 bg-green-400/10 border-green-400/20",under_review:"text-amber-400 bg-amber-400/10 border-amber-400/20",claimed:"text-blue-400 bg-blue-400/10 border-blue-400/20",denied:"text-red-400 bg-red-400/10 border-red-400/20",resolved:"text-gray-400 bg-gray-400/10 border-gray-400/20"},R={open:"Open",under_review:"Under Review",claimed:"In Progress",denied:"Denied",resolved:"Resolved"},S=window.electronAPI,H=({ticket:t,onClick:a,active:l})=>e.jsxs("div",{onClick:()=>a(t),className:`p-4 border-b border-void-border cursor-pointer transition-colors hover:bg-white/5 ${l?"bg-white/5":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h4",{className:"font-semibold text-white text-sm truncate pr-2",children:t.subject}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded border ${T[t.status]||T.open} font-mono uppercase`,children:R[t.status]||t.status})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-void-muted",children:[e.jsx("span",{className:"truncate max-w-[60%]",children:t.category}),e.jsx("span",{children:new Date(t.updated_at).toLocaleDateString()})]}),t.user_name&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-void-bg border border-void-border overflow-hidden",children:t.user_avatar?e.jsx("img",{src:t.user_avatar,alt:"",className:"w-full h-full object-cover"}):e.jsx(A,{className:"w-2.5 h-2.5 m-auto text-void-muted"})}),e.jsx("span",{className:"text-[10px] text-void-muted/80 truncate",children:t.user_name})]})]}),Y=({onCancel:t,onSuccess:a})=>{const[l,c]=o.useState(""),[i,g]=o.useState("general"),[u,x]=o.useState(""),[k,f]=o.useState(!1),[b,m]=o.useState(null),j=async d=>{if(d.preventDefault(),!(!l.trim()||!u.trim())){f(!0),m(null);try{const n=await S.cloudRequest("/api/support/tickets",{method:"POST",body:JSON.stringify({subject:l,category:i,message:u})});n.ok?a(n.ticket):m(n.error||"Failed to create ticket")}catch(n){m(n.message||"Network error")}finally{f(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-void-panel",children:[e.jsxs("div",{className:"p-6 border-b border-void-border flex items-center gap-4",children:[e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx(E,{className:"w-5 h-5 text-void-muted"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"New Support Ticket"})]}),e.jsxs("form",{onSubmit:j,className:"flex-1 overflow-y-auto p-6 space-y-6",children:[b&&e.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg text-red-200 text-sm flex items-center gap-3",children:[e.jsx(J,{className:"w-4 h-4 shrink-0"}),b]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-void-muted uppercase tracking-wider",children:"Category"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:G.map(d=>e.jsx("button",{type:"button",onClick:()=>g(d.id),className:`p-3 rounded-lg border text-left transition-all ${i===d.id?"bg-void-purple/10 border-void-purple text-white":"bg-void-bg border-void-border text-void-muted hover:border-void-muted"}`,children:e.jsx("div",{className:"text-sm font-medium",children:d.label})},d.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-void-muted uppercase tracking-wider",children:"Subject"}),e.jsx("input",{value:l,onChange:d=>c(d.target.value),className:"w-full bg-void-bg border border-void-border rounded-lg px-4 py-3 text-white focus:border-void-purple focus:ring-1 focus:ring-void-purple/50 outline-none transition-all",placeholder:"Briefly describe your issue...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-void-muted uppercase tracking-wider",children:"Message"}),e.jsx("textarea",{value:u,onChange:d=>x(d.target.value),className:"w-full h-48 bg-void-bg border border-void-border rounded-lg px-4 py-3 text-white focus:border-void-purple focus:ring-1 focus:ring-void-purple/50 outline-none transition-all resize-none",placeholder:"Provide detailed information about your request...",required:!0})]})]}),e.jsx("div",{className:"p-6 border-t border-void-border bg-void-bg/30",children:e.jsx("button",{onClick:j,disabled:k||!l||!u,className:"w-full py-3 bg-white text-black font-bold rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:k?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4"}),"Submit Ticket"]})})})]})},Q=({message:t,isSelf:a})=>t.user_id?e.jsxs("div",{className:`flex gap-3 mb-6 ${a?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-void-bg border border-void-border flex items-center justify-center shrink-0 overflow-hidden",children:t.user_avatar?e.jsx("img",{src:t.user_avatar,alt:"",className:"w-full h-full object-cover"}):e.jsx(A,{className:"w-4 h-4 text-void-muted"})}),e.jsxs("div",{className:`max-w-[80%] ${a?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-void-text",children:t.user_name||"User"}),e.jsx("span",{className:"text-[10px] text-void-muted",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.user_role==="super_admin"&&e.jsx($,{className:"w-3 h-3 text-void-purple"}),t.user_role==="moderator"&&e.jsx($,{className:"w-3 h-3 text-blue-400"})]}),e.jsx("div",{className:`p-3 rounded-2xl text-sm leading-relaxed whitespace-pre-wrap ${a?"bg-void-purple/20 text-white rounded-tr-sm border border-void-purple/30":"bg-void-bg border border-void-border text-void-text rounded-tl-sm"}`,children:t.message})]})]}):e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"text-xs text-void-muted bg-void-border/50 px-3 py-1 rounded-full",children:t.message})}),X=({ticketId:t,onBack:a,currentUser:l,isMod:c})=>{const[i,g]=o.useState(null),[u,x]=o.useState([]),[k,f]=o.useState(!0),[b,m]=o.useState(""),[j,d]=o.useState(!1),[n,w]=o.useState(!1),h=o.useRef(null),N=o.useCallback(async()=>{try{const s=await S.cloudRequest(`/api/support/tickets/${t}`);s.ok&&(g(s.ticket),x(s.messages))}catch(s){console.error(s)}finally{f(!1)}},[t]);o.useEffect(()=>{N();const s=setInterval(N,5e3);return()=>clearInterval(s)},[N]),o.useEffect(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[u]);const C=async()=>{if(b.trim()){d(!0);try{await S.cloudRequest(`/api/support/tickets/${t}/message`,{method:"POST",body:JSON.stringify({message:b})}),m(""),N()}catch(s){console.error(s)}finally{d(!1)}}},v=async s=>{if(confirm(`Are you sure you want to ${s} this ticket?`))try{await S.cloudRequest(`/api/support/tickets/${t}/${s}`,{method:"POST"}),N()}catch(p){console.error(p)}},r=async()=>{if(c&&confirm("Delete this ticket? This cannot be undone.")){w(!0);try{const s=await S.cloudRequest(`/api/support/tickets/${t}`,{method:"DELETE"});if(s?.ok){a();return}alert(s?.error||"Failed to delete ticket")}catch(s){alert(s?.message||"Failed to delete ticket")}finally{w(!1)}}};return k?e.jsx("div",{className:"flex items-center justify-center h-full text-void-muted",children:"Loading ticket..."}):i?l?.id?e.jsxs("div",{className:"flex flex-col h-full bg-void-panel",children:[e.jsxs("div",{className:"p-4 border-b border-void-border bg-void-bg/50 backdrop-blur-sm flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/5 rounded-lg text-void-muted hover:text-white transition-colors",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-bold text-white text-base flex items-center gap-2",children:[i.subject,e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded border ${T[i.status]||T.open} font-mono uppercase`,children:R[i.status]||i.status})]}),e.jsxs("div",{className:"text-xs text-void-muted flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"uppercase tracking-wider font-bold text-[10px]",children:i.category}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Ticket #",i.id.slice(0,8)]})]})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:r,disabled:n,className:"px-3 py-1.5 bg-red-500/10 text-red-300 border border-red-500/20 rounded text-xs font-bold hover:bg-red-500/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"Delete ticket",children:[e.jsx(K,{className:"w-4 h-4"}),n?"Deleting…":"Delete"]}),i.status==="open"&&e.jsx("button",{onClick:()=>v("claim"),className:"px-3 py-1.5 bg-blue-500/20 text-blue-300 border border-blue-500/30 rounded text-xs font-bold hover:bg-blue-500/30 transition-colors",children:"Claim Ticket"}),(i.status==="claimed"||i.status==="under_review")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>v("resolve"),className:"px-3 py-1.5 bg-green-500/20 text-green-300 border border-green-500/30 rounded text-xs font-bold hover:bg-green-500/30 transition-colors",children:"Resolve"}),e.jsx("button",{onClick:()=>v("deny"),className:"px-3 py-1.5 bg-red-500/20 text-red-300 border border-red-500/30 rounded text-xs font-bold hover:bg-red-500/30 transition-colors",children:"Deny"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u.map(s=>e.jsx(Q,{message:s,isSelf:l?.id&&s.user_id===l.id},s.id)),e.jsx("div",{ref:h})]}),i.status==="open"||i.status==="claimed"||i.status==="under_review"?e.jsx("div",{className:"p-4 border-t border-void-border bg-void-bg/50",children:e.jsxs("div",{className:"flex items-end gap-2 bg-void-bg border border-void-border rounded-xl p-2 focus-within:border-void-purple/50 focus-within:ring-1 focus-within:ring-void-purple/20 transition-all",children:[e.jsx("button",{className:"p-2 text-void-muted hover:text-white transition-colors",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx("textarea",{value:b,onChange:s=>m(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),C())},placeholder:"Type your message...",className:"flex-1 bg-transparent border-none outline-none text-white text-sm max-h-32 min-h-[2.5rem] py-2 resize-none",rows:1}),e.jsx("button",{onClick:C,disabled:!b.trim()||j,className:"p-2 bg-void-purple text-white rounded-lg hover:bg-void-purple/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(q,{className:"w-4 h-4"})})]})}):e.jsxs("div",{className:"p-4 border-t border-void-border bg-void-bg/50 text-center text-xs text-void-muted uppercase tracking-widest font-bold",children:["This ticket is ",R[i.status]||i.status]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-void-muted",children:"Please sign in to view tickets"}):e.jsx("div",{className:"flex items-center justify-center h-full text-red-400",children:"Ticket not found"})},W=({onClose:t,user:a,isModal:l=!1})=>{const[c,i]=o.useState("list"),[g,u]=o.useState(null),[x,k]=o.useState([]),[f,b]=o.useState(!1),[m,j]=o.useState(""),[d,n]=o.useState("all"),w=a?.role==="super_admin"||a?.role==="moderator",h=o.useCallback(async()=>{b(!0);try{const r=await S.cloudRequest("/api/support/tickets");r.ok&&k(r.tickets)}catch(r){console.error(r)}finally{b(!1)}},[]);o.useEffect(()=>{h()},[h]);const N=r=>{u(r.id),i("detail")},C=D.useMemo(()=>{const r=String(m||"").trim().toLowerCase();let s=Array.isArray(x)?x.slice():[];return d!=="all"&&(s=s.filter(p=>String(p?.status||"open")===d)),r&&(s=s.filter(p=>{const _=String(p?.subject||"").toLowerCase(),y=String(p?.category||"").toLowerCase(),I=String(p?.user_name||"").toLowerCase(),O=String(p?.user_email||"").toLowerCase();return _.includes(r)||y.includes(r)||I.includes(r)||O.includes(r)})),s},[x,m,d]),v=D.useMemo(()=>{const r=Array.isArray(x)?x:[],s=r.filter(y=>String(y?.status||"open")==="open").length,p=r.filter(y=>String(y?.status||"open")==="claimed").length,_=r.filter(y=>String(y?.status||"open")==="under_review").length;return{total:r.length,open:s,claimed:p,underReview:_}},[x]);return e.jsxs("div",{className:`w-full h-full bg-void-panel border border-void-border rounded-2xl shadow-2xl flex overflow-hidden ${l?"max-w-5xl h-[85vh] animate-in zoom-in-95 duration-200":"rounded-none border-none shadow-none"}`,children:[e.jsxs("div",{className:`w-80 border-r border-void-border bg-void-bg/50 flex flex-col ${c!=="list"?"hidden md:flex":"flex w-full"}`,children:[e.jsxs("div",{className:"p-4 border-b border-void-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-void-panel border border-void-border flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-void-purple"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-extrabold text-white leading-tight",children:"Support Center"}),e.jsx("div",{className:"text-[10px] text-void-muted font-bold uppercase tracking-widest",children:w?"Admin Console":"Customer Support"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:h,className:"p-2 rounded-lg text-void-muted hover:text-white hover:bg-white/5 transition-colors",title:"Refresh",children:e.jsx(M,{className:`w-4 h-4 ${f?"animate-spin":""}`})}),t&&e.jsx("button",{onClick:t,className:"md:hidden p-2 text-void-muted hover:text-white hover:bg-white/5 rounded-lg transition-colors",children:e.jsx(F,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"p-4",children:e.jsxs("button",{onClick:()=>i("create"),className:"w-full py-2.5 bg-gradient-to-r from-void-purple to-void-cyan text-white font-bold rounded-lg shadow-lg shadow-void-purple/20 hover:opacity-90 active:scale-95 transition-all flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Create New Ticket"]})}),e.jsxs("div",{className:"px-4 pb-2 space-y-3",children:[e.jsx("div",{className:"text-xs font-bold text-void-muted uppercase tracking-wider",children:w?"All Tickets":"Your Tickets"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"px-2 py-1 rounded-md border border-void-border bg-void-panel-2 text-[10px] font-bold text-void-muted uppercase tracking-widest",children:["Total ",v.total]}),e.jsxs("div",{className:"px-2 py-1 rounded-md border border-green-500/20 bg-green-500/10 text-[10px] font-bold text-green-200 uppercase tracking-widest",children:["Open ",v.open]}),e.jsxs("div",{className:"px-2 py-1 rounded-md border border-blue-500/20 bg-blue-500/10 text-[10px] font-bold text-blue-200 uppercase tracking-widest",children:["In progress ",v.claimed]}),e.jsxs("div",{className:"px-2 py-1 rounded-md border border-amber-500/20 bg-amber-500/10 text-[10px] font-bold text-amber-200 uppercase tracking-widest",children:["Review ",v.underReview]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-void-panel-2 border border-void-border rounded-lg px-3 py-2",children:[e.jsx(U,{className:"w-4 h-4 text-void-muted"}),e.jsx("input",{value:m,onChange:r=>j(r.target.value),placeholder:w?"Search subject, user, category...":"Search subject, category...",className:"w-full bg-transparent outline-none text-void-muted text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-void-panel-2 border border-void-border rounded-lg px-3 py-2",children:[e.jsx(B,{className:"w-4 h-4 text-void-muted"}),e.jsxs("select",{value:d,onChange:r=>n(r.target.value),className:"w-full bg-transparent outline-none text-void-muted text-sm",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"claimed",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"denied",children:"Denied"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f?e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("div",{className:"h-16 rounded-xl bg-white/5 border border-void-border/50 animate-pulse"}),e.jsx("div",{className:"h-16 rounded-xl bg-white/5 border border-void-border/50 animate-pulse"}),e.jsx("div",{className:"h-16 rounded-xl bg-white/5 border border-void-border/50 animate-pulse"})]}):C.length===0?e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-void-panel border border-void-border flex items-center justify-center mx-auto",children:e.jsx(L,{className:"w-8 h-8 text-void-muted"})}),e.jsx("div",{className:"mt-4 text-sm font-bold text-white",children:"No tickets found"}),e.jsx("div",{className:"mt-1 text-xs text-void-muted",children:"Try adjusting your search or status filter."}),e.jsx("button",{onClick:()=>{j(""),n("all")},className:"mt-5 px-4 py-2 bg-void-panel-2 hover:bg-white/10 border border-void-border rounded-lg text-xs font-bold text-white transition-colors",children:"Clear filters"})]}):C.map(r=>e.jsx(H,{ticket:r,active:g===r.id,onClick:N},r.id))}),t&&e.jsx("div",{className:"p-4 border-t border-void-border",children:e.jsx("button",{onClick:t,className:"w-full py-2 text-void-muted hover:text-white text-sm font-medium transition-colors",children:"Close Support"})})]}),e.jsxs("div",{className:`flex-1 bg-void-bg relative ${c==="list"?"hidden md:block":"block"}`,children:[c==="list"&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-void-muted/50 gap-4",children:[e.jsx(L,{className:"w-16 h-16 opacity-20"}),e.jsx("div",{className:"text-sm font-semibold",children:"Select a ticket to view the conversation"}),e.jsx("div",{className:"text-xs",children:"You can create a new ticket anytime using the button on the left."})]}),c==="create"&&e.jsx(Y,{onCancel:()=>i("list"),onSuccess:r=>{h(),u(r.id),i("detail")}}),c==="detail"&&g&&e.jsx(X,{ticketId:g,onBack:()=>{i("list"),h()},currentUser:a,isMod:w})]})]})},se=({isOpen:t,onClose:a,user:l})=>t?e.jsx("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6 animate-in fade-in duration-200",children:e.jsx(W,{onClose:a,user:l,isModal:!0})}):null;export{se as SupportModal,W as SupportSystemContent,W as default};
